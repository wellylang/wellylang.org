#!/bin/sh

set -eu

# Edit these to configure the paths where you installed the libraries.
FOUNDATION_DIR=../foundation-6.2.3-complete
PRETTIFY_DIR=../code-prettify

# These are inside the wellylang.org repo.
SOURCE_DIR=src
BUILD_DIR=build

# Remove relics of previous builds.
mkdir -p $BUILD_DIR
rm -rf -- $BUILD_DIR/*
cat >$BUILD_DIR/README.txt <<EOF
These files are auto-generated by "make.sh". Do not edit them.
EOF

# Copy needed libraries into place.
mkdir -p $BUILD_DIR/js
mkdir -p $BUILD_DIR/css
cp -R $FOUNDATION_DIR/js/* $BUILD_DIR/js
cp -R $FOUNDATION_DIR/css/* $BUILD_DIR/css
cp -R $PRETTIFY_DIR/src/prettify.js $BUILD_DIR/js
cp -R $PRETTIFY_DIR/src/prettify.css $BUILD_DIR/css
cp -R $PRETTIFY_DIR/styles/sunburst.css $BUILD_DIR/css
cp -R src/js/* $BUILD_DIR/js
cp -R src/css/* $BUILD_DIR/css

convert-filename () {
  local filename=$1
  local target=$(echo $filename | sed 's,/,_,g').html
  nancy --root $SOURCE_DIR template.html $filename > $BUILD_DIR/$target
}

for key in index project_goals installation first_program \
  question_answer data_types variables operators language_comparison \
  about contact history history/declaration history/dynamic \
  history/field_constnesses history/for_array0 basic_syntax \
  basic_syntax/newlines
do
  convert-filename $key
done
